# Окружение для сервера приложений 1С-Битрикс на PHP

## Общие требования

Необходимо собрать Dockerfile и связанные с ним конфигурационные файлы для запуска в этой среде приложения 1С-Битрикс.

Образ должен базироваться на официальном образе PHP 7.4 с сервером Apache и обязательно обеспечивать корректную обработку всех директив из файлов `.htaccess` запущенного в нем приложения.

## Обязательные расширения PHP

Должен содержать обязательный набор расширений:

* mysqli
* mbstring
* gd с поддержкой webp, jpeg, xpm и freetype
* xml
* FreeType
* Поддерживать регулярные выражения
* Zlib compression
* PHP openssl
* PHP-акселератор: OPcache или XCache (предпочтительно OPcache)

Для корректной поддержки кодировки UTF-8 необходимо проверить, установлен ли в PHP модуль mbstring. Для этого в настройках PHP, в файле php.ini, должно быть:

```text
 mbstring.func_overload=2
 mbstring.internal_encoding=UTF-8
```

## Дополнительные расширения PHP

Дополнительные расширения должны устанавливаться в отдельном слое от обязательных расширений.

* bz2
* calendar
* curl
* dom
* exif
* fileinfo
* ftp
* iconv
* json
* mcrypt
* zip
* geoip или актуальный аналог
* memcache
* apcu

## Настройки PHP

Для корректной работы продукта необходимо установить следующие параметры PHP:

* `memory_limit = 64M;` Максимальный объем памяти в байтах, который разрешается использовать для работы PHP ядру продукта (в данном случае – 64 Мб).
* `file_uploads = On;` Параметр определяет возможность загрузки на сервер файлов. Дополнительно к указанному параметру устанавливаются значения следующих параметров:
  * `upload_tmp_dir = < имя каталога >`
  * `upload_max_filesize = <достаточный размер>`
* Необходимо, чтобы была корректно настроена работа с сессиями в PHP. Рекомендуется проверить наличие пути для сохранения файлов сессий. С целью защиты от появления в параметрах URL на сервере `PHPSESSID=...`, в файл php.ini установить: `session.use_trans_sid = 0`.
